<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>FelipeRevolution - Panel</title>
  <style>
    body {
      margin: 0;
      background: #0a0a0f;
      color: #fff;
      font-family: 'Poppins', sans-serif;
    }
    header {
      background: linear-gradient(90deg, #000, #13132b);
      padding: 10px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 0 10px #0ff;
    }
    .logo {
      font-size: 1.5em;
      color: #0ff;
      font-weight: bold;
    }
    .user-info {
      text-align: right;
      font-size: 0.9em;
    }
    .container {
      padding: 20px;
    }
    h2 {
      color: #0ff;
      border-bottom: 2px solid #0ff;
      padding-bottom: 5px;
    }
    .section {
      background: #13132b;
      border-radius: 10px;
      margin-bottom: 20px;
      padding: 15px;
      box-shadow: 0 0 10px #0ff3;
    }
    input, select, button {
      background: #0a0a0f;
      color: #0ff;
      border: 1px solid #0ff;
      padding: 8px;
      border-radius: 6px;
      margin: 4px 0;
      outline: none;
    }
    button:hover {
      background: #0ff;
      color: #000;
      cursor: pointer;
    }
    .item {
      background: #0f0f2a;
      padding: 10px;
      margin: 6px 0;
      border-radius: 6px;
      box-shadow: 0 0 5px #0ff2;
    }
    .hidden {
      display: none;
    }
  </style>
</head>
<body>
  <header>
    <div class="logo">âš¡ FelipeRevolution Panel</div>
    <div class="user-info">
      Usuario: <span id="userName"></span><br>
      Rol: <span id="userRole"></span><br>
      Saldo: $<span id="userBalance"></span><br>
      <button id="logoutBtn">Cerrar sesiÃ³n</button>
    </div>
  </header>

  <div class="container">
    <div id="ownerPanel" class="hidden">
      <h2>ðŸ§  Panel del Owner</h2>

      <!-- ðŸ”¹ GESTIÃ“N DE USUARIOS -->
      <div class="section">
        <h3>ðŸ‘¤ GestiÃ³n de usuarios</h3>
        <button onclick="cargarUsuarios()">ðŸ”„ Recargar usuarios</button>
        <div id="listaUsuarios">Cargando...</div>
      </div>

      <!-- ðŸ”¹ GESTIÃ“N DE PRODUCTOS -->
      <div class="section">
        <h3>ðŸ›’ GestiÃ³n de productos</h3>
        <form id="formProducto">
          <input type="text" id="nombreProducto" placeholder="Nombre del producto" required>
          <input type="number" id="precioProducto" placeholder="Precio" required>
          <input type="number" id="stockProducto" placeholder="Stock" required>
          <input type="text" id="imagenProducto" placeholder="URL de imagen">
          <button type="submit">Agregar producto</button>
        </form>
        <div id="listaProductos">Cargando...</div>
      </div>

      <!-- ðŸ”¹ GESTIÃ“N DE LICENCIAS -->
      <div class="section">
        <h3>ðŸ”‘ GestiÃ³n de licencias</h3>
        <form id="formLicencia">
          <input type="text" id="codigoLicencia" placeholder="CÃ³digo" required>
          <input type="text" id="usuarioLicencia" placeholder="Usuario" required>
          <input type="text" id="productoLicencia" placeholder="Producto" required>
          <input type="number" id="diasLicencia" placeholder="DuraciÃ³n (dÃ­as)" required>
          <button type="submit">Agregar licencia</button>
        </form>
        <div id="listaLicencias">Cargando...</div>
      </div>
    </div>
  </div>

  <script>
    const user = JSON.parse(localStorage.getItem('activeUser'));

    // Si no hay sesiÃ³n activa, volver al login
    if (!user) {
      window.location.href = "index.html";
    }

    document.getElementById('userName').textContent = user.username;
    document.getElementById('userRole').textContent = user.role;
    document.getElementById('userBalance').textContent = user.saldo.toFixed(2);

    document.getElementById('logoutBtn').addEventListener('click', () => {
      localStorage.removeItem('activeUser');
      window.location.href = 'index.html';
    });

    // Mostrar panel del owner
    if (user.role === "owner") {
      document.getElementById("ownerPanel").classList.remove("hidden");
      cargarUsuarios();
      cargarProductos();
      cargarLicencias();
    }

    // === USUARIOS ===
    async function cargarUsuarios() {
      const cont = document.getElementById("listaUsuarios");
      try {
        const res = await fetch("usuarios.json");
        const data = await res.json();
        cont.innerHTML = data.usuarios.map((u, i) => `
          <div class="item">
            <b>${u.username}</b> (${u.role}) - Saldo: $${u.saldo}
            <br>
            <button onclick="cambiarRol(${i})">Cambiar rol</button>
            <button onclick="sumarSaldo(${i})">+ Saldo</button>
            <button onclick="restarSaldo(${i})">- Saldo</button>
            <button onclick="eliminarUsuario(${i})">Eliminar</button>
          </div>
        `).join("");
        localStorage.setItem("usuariosTemp", JSON.stringify(data.usuarios));
      } catch (e) {
        cont.innerHTML = "Error al cargar usuarios.json";
      }
    }

    function cambiarRol(i) {
      let lista = JSON.parse(localStorage.getItem("usuariosTemp"));
      lista[i].role = lista[i].role === "cliente" ? "admin" : "cliente";
      localStorage.setItem("usuariosTemp", JSON.stringify(lista));
      alert(`Rol cambiado a ${lista[i].role}`);
      cargarUsuarios();
    }
    function sumarSaldo(i) {
      let lista = JSON.parse(localStorage.getItem("usuariosTemp"));
      lista[i].saldo += 10;
      localStorage.setItem("usuariosTemp", JSON.stringify(lista));
      cargarUsuarios();
    }
    function restarSaldo(i) {
      let lista = JSON.parse(localStorage.getItem("usuariosTemp"));
      lista[i].saldo = Math.max(0, lista[i].saldo - 10);
      localStorage.setItem("usuariosTemp", JSON.stringify(lista));
      cargarUsuarios();
    }
    function eliminarUsuario(i) {
      let lista = JSON.parse(localStorage.getItem("usuariosTemp"));
      if (confirm("Â¿Eliminar este usuario?")) {
        lista.splice(i, 1);
        localStorage.setItem("usuariosTemp", JSON.stringify(lista));
        cargarUsuarios();
      }
    }

    // === PRODUCTOS ===
    async function cargarProductos() {
      const cont = document.getElementById("listaProductos");
      try {
        const res = await fetch("productos.json");
        const data = await res.json();
        cont.innerHTML = data.productos.map((p, i) => `
          <div class="item">
            <b>${p.nombre}</b> - $${p.precio} | Stock: ${p.stock}
            <br><img src="${p.imagen}" width="100"><br>
            <button onclick="eliminarProducto(${i})">Eliminar</button>
          </div>
        `).join("");
        localStorage.setItem("productosTemp", JSON.stringify(data.productos));
      } catch (e) {
        cont.innerHTML = "Error al cargar productos.json";
      }
    }

    document.getElementById("formProducto").addEventListener("submit", e => {
      e.preventDefault();
      const lista = JSON.parse(localStorage.getItem("productosTemp")) || [];
      lista.push({
        nombre: nombreProducto.value,
        precio: parseFloat(precioProducto.value),
        stock: parseInt(stockProducto.value),
        imagen: imagenProducto.value || "assets/images/default.png"
      });
      localStorage.setItem("productosTemp", JSON.stringify(lista));
      alert("Producto agregado (local)");
      e.target.reset();
      cargarProductos();
    });

    function eliminarProducto(i) {
      let lista = JSON.parse(localStorage.getItem("productosTemp"));
      lista.splice(i, 1);
      localStorage.setItem("productosTemp", JSON.stringify(lista));
      cargarProductos();
    }

    // === LICENCIAS ===
    async function cargarLicencias() {
      const cont = document.getElementById("listaLicencias");
      try {
        const res = await fetch("licencias.json");
        const data = await res.json();
        cont.innerHTML = data.licencias.map((l, i) => `
          <div class="item">
            <b>${l.codigo}</b> - ${l.usuario} (${l.producto}) | ${l.dias} dÃ­as
            <button onclick="eliminarLicencia(${i})">Eliminar</button>
          </div>
        `).join("");
        localStorage.setItem("licenciasTemp", JSON.stringify(data.licencias));
      } catch (e) {
        cont.innerHTML = "Error al cargar licencias.json";
      }
    }

    document.getElementById("formLicencia").addEventListener("submit", e => {
      e.preventDefault();
      const lista = JSON.parse(localStorage.getItem("licenciasTemp")) || [];
      lista.push({
        codigo: codigoLicencia.value,
        usuario: usuarioLicencia.value,
        producto: productoLicencia.value,
        dias: parseInt(diasLicencia.value),
        fecha: new Date().toISOString().split('T')[0]
      });
      localStorage.setItem("licenciasTemp", JSON.stringify(lista));
      alert("Licencia agregada (local)");
      e.target.reset();
      cargarLicencias();
    });

    function eliminarLicencia(i) {
      let lista = JSON.parse(localStorage.getItem("licenciasTemp"));
      lista.splice(i, 1);
      localStorage.setItem("licenciasTemp", JSON.stringify(lista));
      cargarLicencias();
    }
  </script>
</body>
  </html>
